# 数据一致性检查报告

生成时间：2024-11-26

## 数据规模

- **商场总数**: 581 条
- **门店总数**: 1229 条
  - DJI: 788 条
  - Insta360: 441 条

## 检查结果总结

| 检查项 | 状态 | 说明 |
|--------|------|------|
| mall_id 唯一性 | ✅ 通过 | 所有 mall_id 唯一 |
| 门店商场关联 | ✅ 通过 | 所有门店的 mall_id 都在商场表中，mall_name 一致 |
| store_count 准确性 | ✅ 通过 | 所有商场的 store_count 准确 |
| 坐标合理性 | ⚠️ 部分通过 | 44 个门店距离商场>2km |
| 城市一致性 | ✅ 通过 | 所有门店和商场的城市一致 |
| JSON-CSV 一致性 | ✅ 基本通过 | 门店和商场数量一致，抽样检查发现1个小差异 |
| 商场名称正常性 | ✅ 通过 | 无店铺名特征 |

**通过率**: 5/7 (71.4%)

## 修复历史

### 1. 使用 LLM 修复商场名称（33条）

将错误的店铺名（屈臣氏、美宜佳、盒马等）修正为正确的商场名。

### 2. 修复重复的 mall_id（9+9=18条）

两次修复重复ID：
- 第一次：为不同城市的重复商场分配新ID（MALL_00611-MALL_00619）
- 第二次：清理遗留的重复ID（MALL_00631-MALL_00639）

### 3. 拆分错误合并的商场（17条）

将被错误合并到同一个 mall_id 的不同商场拆分，新建商场：
- 深圳前海壹方汇
- 重庆时代天街、重庆光环花园城
- 深圳华强北赛格科技园
- 厦门SM新生活广场
- 德阳旌阳万达广场
- 广州荔湾领展购物广场
- 保定北国先天下
- 长沙宜家荟聚
- 大庆让胡路万达广场
- 福州烟台山
- 贵阳观山湖万象汇
- 合肥庐阳万象汇
- 深圳大运天地
- 成都IFS国际金融中心
- 等

### 4. 恢复被错误修改的商场名（17条）

LLM 修复脚本将一些商场名错误修改，已恢复为 original_name：
- 永庆坊、深圳宝安机场、荆州万达、昆明恒隆广场等

### 5. 修复城市不匹配（7条）

修正了因拆分商场时关联错误导致的城市不匹配问题。

### 6. 清理无门店商场（7条）

删除了没有门店关联的商场记录。

## 需要注意的问题

### 1. 门店距离商场较远（44条）

以下门店距离所属商场超过2km，可能需要人工核查：

| 门店 | 商场 | 距离 | 城市 |
|------|------|------|------|
| 重庆国泰优活城市广场授权体验店 | 协信星光广场 | 146.1km | 重庆市 |
| 影石Insta360重庆国泰广场授权专卖店 | 协信星光广场 | 65.2km | 重庆市 |
| 北京龙湖亦庄天街授权体验店 | 龙湖北京亦庄天街 | 35.3km | 北京市 |
| 东莞长安万科授权体验店 | 万科广场(东莞长安店) | 25.1km | 东莞市 |
| ... | ... | ... | ... |

**建议**: 这些可能是：
- 商场坐标不准确（需要重新获取）
- 门店实际不在商场内（应清除 mall 关联）
- 同名但不同位置的商场（需要创建新商场记录）

### 2. 同一品牌在同一商场有多家门店（11条）

以下情况根据用户要求暂不处理：

| 商场 | 品牌 | 数量 | 说明 |
|------|------|------|------|
| 昆山万象汇 | Insta360 | 2 | 疑似重复 |
| 重庆来福士广场 | Insta360 | 2 | 疑似重复 |
| 北京朝阳合生汇 | Insta360 | 2 | 疑似重复 |
| 南宁万象城 | DJI | 2 | 概念店+授权店 |
| 厦门万象城 | DJI | 2 | 概念店+授权店 |
| 太古汇 | DJI | 2 | DJI店+哈苏店 |
| 昆明恒隆广场 | DJI | 2 | 概念店+授权店 |
| 正佳广场 | DJI | 2 | 授权专区+授权店 |
| 天津万象城 | DJI | 2 | 概念店+授权店 |
| 成都太古里 | DJI | 2 | DJI店+哈苏店 |
| 南昌红谷滩万达 | DJI | 2 | 授权店+授权专区 |

## 数据文件状态

### CSV 文件
- ✅ `Mall_Master_Cleaned.csv`: 581 条商场记录
- ✅ `Store_Master_Cleaned.csv`: 1229 条门店记录
- ✅ 所有字段完整，关联正确

### JSON 文件
- ✅ `dji_stores.json`: 788 条记录
- ✅ `insta360_stores.json`: 441 条记录
- ✅ `malls.json`: 581 条记录
- ✅ 包含品牌进驻信息（hasDJI, hasInsta360）

## 建议

1. **对于距离较远的44个门店**: 需要人工逐一核查，确认是否应该保留商场关联
2. **对于疑似重复的门店**: 建议检查是否是同一家店铺的重复录入
3. **定期维护**: 当有新门店或商场数据时，建议运行 `comprehensive_data_check.py` 进行完整性检查

## 核心脚本

### 数据处理
- `normalize_store_mall_data.py` - 核心标准化脚本
- `csv_to_json.py` - 生成前端 JSON

### 数据修复
- `fix_mall_names_with_llm.py` - LLM 修复商场名
- `fix_duplicate_mall_ids.py` - 修复重复 ID
- `fix_wrong_mall_associations.py` - 拆分错误合并的商场
- `fix_all_data_issues.py` - 综合修复脚本

### 数据检查
- `comprehensive_data_check.py` - 全面数据一致性检查

### 已删除的临时脚本（18个）
所有一次性修复脚本已被识别并删除，确保代码库整洁。

